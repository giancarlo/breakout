(function(window,j5g3,undefined){j5g3.Loader=j5g3.Class.extend({EVENT:{IMG:"load",AUDIO:"canplaythrough",SCRIPT:"load"},sources:null,delay:250,progress:0,start:null,length:0,on_progress:null,on_source:null,init:function j5g3Loader(p){j5g3.Class.apply(this,[p]);this.sources={};this.start=new Date},_check_ready:function(callback){var i,ready=0,length=0,me=this;for(i in this.sources){length++;if(this.sources.hasOwnProperty(i)&&this.sources[i].ready)ready++}this.progress=ready?ready/length:0;if(this.on_progress)this.on_progress(this.progress);if(length===ready){if(callback)callback()}else this._timeout=window.setTimeout(function(){me._check_ready(callback)},this.delay)},el:function(tag,src){var me=this,result=this.sources[src],source;if(!result){result=j5g3.dom(tag);this.sources[src]=source={el:result};result.addEventListener(this.EVENT[tag],function(){source.ready=true;if(me.on_source)me.on_source(source)},false);result.setAttribute("src",src);this.length++}return result},img:function(src){return this.el("IMG",src)},audio:function(src){return this.el("AUDIO",src)},script:function(src){var result=this.el("SCRIPT",src);window.document.head.appendChild(result);return result},ready:function(callback){this._check_ready(callback)},destroy:function(){window.clearTimeout(this._timeout)}});j5g3.loader=j5g3.factory(j5g3.Loader)})(this,this.j5g3);